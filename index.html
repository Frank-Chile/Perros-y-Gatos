

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Predicción de Imagen Estática</title>
  </head>
  <body>
    <h1>Predicción de Imagen Estática con TensorFlow.js</h1>
    
    <!-- Input para seleccionar la imagen -->
    <input type="file" id="imagen-input" accept="image/*" />
    <canvas id="canvas" style="display: none;"></canvas>
    <div id="resultado"></div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"></script>
    <script>
      var modelo = null;

      // Cargar el modelo
      (async () => {
        console.log("Cargando modelo...");
        modelo = await tf.loadLayersModel('model.json');
        console.log("Modelo cargado");
      })();

      // Manejar la carga de la imagen
      document.getElementById('imagen-input').addEventListener('change', function(e) {
        if (modelo == null) {
          alert("El modelo aún no está cargado.");
          return;
        }

        var archivo = e.target.files[0];
        if (!archivo || !archivo.type.startsWith('image/')) {
          alert("Por favor selecciona una imagen válida.");
          return;
        }

        var reader = new FileReader();

        reader.onload = function(event) {
          var img = new Image();
          img.onload = function() {
            // Dibujar la imagen en un canvas
            var canvas = document.getElementById('canvas');
            var ctx = canvas.getContext('2d');
            canvas.width = 224; // Ajusta el tamaño según lo que espera tu modelo
            canvas.height = 224;
            ctx.drawImage(img, 0, 0, 224, 224);

            // Convertir la imagen del canvas a un tensor sin normalización
            let tensor = tf.browser.fromPixels(canvas).expandDims(0); // [1, 224, 224, 3]

            // Hacer la predicción
            modelo.predict(tensor).data().then((resultado) => {
              console.log("Resultado de la predicción:", resultado);

              var class_names = [
                "Step_1",
                "Step_2_Left",
                "Step_2_Right",
                "Step_3",
                "Step_4_Left",
                "Step_4_Right",
                "Step_5_Left",
                "Step_5_Right",
                "Step_6_Left",
                "Step_6_Right",
                "Step_7_Left",
                "Step_7_Right",
              ];

              var maxIndex = resultado.indexOf(Math.max(...resultado));
              var respuesta = class_names[maxIndex];

              // Mostrar la predicción en la página
              document.getElementById('resultado').innerHTML = "Predicción: " + respuesta;
            }).catch((error) => {
              console.error("Error en la predicción:", error);
              alert("Error en la predicción. Ver consola para más detalles.");
            });
          };

          img.src = event.target.result;
        };

        reader.readAsDataURL(archivo);
      });
    </script>
  </body>
</html>
